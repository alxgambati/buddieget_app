<div class="container">

  <div class="row dashboard-top-buffer">

    <div class="user-account card p-4 col-sm-12 col-md-3 col-lg-4">
      <div class="d-flex">
        <% if current_user.photo %>
          <%= cl_image_tag current_user.photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
        <% else %>
          <%= image_tag('neutral-avatar.png') %>
        <% end %>
        <div class="user-account-info ml-3" style="display:inline-block; align-self:flex-end;">
          <p><%= "#{current_user.first_name} #{current_user.last_name}" %></p>
          <p><%= current_user.email %></p>
          <% if current_user.city %>
            <p><i class="fa fa-map-marker-alt"></i><%= current_user.city %></p>
          <% end %>
        </div>
      </div>
      <%= link_to 'Edit personal data', edit_user_path,  class: "btn btn-success w-100", style: 'margin-top:15px' %>
      <%= link_to 'Delete this account!', registration_path(current_user), data: { confirm: "Are you sure?" }, method: :delete,  class: "btn btn-danger w-100", style: 'margin-top:15px' %>
      <%= link_to 'Offer a new service!', new_service_path,  class: "btn btn-primary", style: 'margin-top:50px' %>
    </div>

    <div class="col-sm-12 col-md-9 col-lg-8">
      <div class="navbar navbar-expand-lg navbar-light bg-light" id="navbar-account">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <%= link_to "Orders", dashboard_path(results_query: 'orders'), class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Services Offered", dashboard_path(results_query: 'services_offered'), class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Services Sold", dashboard_path(results_query: 'services_sold'), class: "nav-link" %>
          </li>
        </ul>
      </div>

      <div class="dashboard-results dashboard-top-buffer mx-3">
        <% if @results == 'orders' %>
          <% @orders.each do |order| %>
          <div class="dashboard-results-card card my-4">
            <div class="flex-area d-flex p-3">
              <div class="principal" style="width:35%">
                <% if current_user.photo %>
                  <%= cl_image_tag order.service.user.photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                <% else %>
                  <%= image_tag('neutral-avatar.png') %>
                <% end %>
                <div class="user-account-info mt-3">
                  <p><%= "#{order.service.user.first_name} #{order.service.user.last_name}" %></p>
                  <p><%= order.service.user.email %></p>
                  <p><i class="fa fa-map-marker-alt"></i><%= order.service.user.city %></p>
                </div>
              </div>
              <div class="user-account-details ml-3">
                <p><b><%= order.service.category.capitalize %></b></p>
                <p><%= order.service.description %></p>
                <p><%= order.created_at.to_date %></p>
                <p><b><%= number_to_currency(order.service.price, unit: "R$", separator: ",", delimiter: ".") %></b></p>
              </div>
            </div>
          </div>
          <% end %>
        <% elsif @results == 'services_offered' %>
          <% @services.each do |service| %>
          <div class="dashboard-results-card card my-4">
            <div class="flex-area d-flex p-3">
              <div class="principal" style="width:35%">
                <% if current_user.photo %>
                  <%= cl_image_tag service.user.photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                <% else %>
                  <%= image_tag('neutral-avatar.png') %>
                <% end %>
                <div class="user-account-info mt-3">
                  <p><%= "#{service.user.first_name} #{service.user.last_name}" %></p>
                  <p><%= service.user.email %></p>
                  <p><i class="fa fa-map-marker-alt"></i><%= service.user.city%></p>
                </div>
              </div>
              <div class="user-account-details ml-3">
                <p><b><%= service.category.capitalize %></b></p>
                <p><%= service.description %></p>
                <p><%= service.created_at.to_date %></p>
                <p><b><%= number_to_currency(service.price, unit: "R$", separator: ",", delimiter: ".") %></b></p>
              </div>
            </div>
          </div>
          <% end %>
        <% elsif @results == 'services_sold' %>
          <% @services.each do |service| %>
            <% service.orders.each do |order| %>
              <div class="dashboard-results-card card my-4">
                <div class="flex-area d-flex p-3">
                  <div class="principal" style="width:35%">
                    <% if current_user.photo %>
                      <%= cl_image_tag order.user.photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                    <% else %>
                      <%= image_tag('neutral-avatar.png') %>
                    <% end %>
                    <div class="user-account-info mt-3">
                      <p><%= "#{order.user.first_name} #{order.user.last_name}" %></p>
                      <p><%= order.user.email %></p>
                      <p><i class="fa fa-map-marker-alt"></i><%= order.user.city%></p>
                    </div>
                  </div>
                  <div class="user-account-details ml-3">
                    <p><b><%= order.service.category.capitalize %></b></p>
                    <p><%= order.service.description %></p>
                    <p><%= order.created_at.to_date %></p>
                    <p><b><%= number_to_currency(order.service.price, unit: "R$", separator: ",", delimiter: ".") %></b></p>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>

       </div>
    </div>

  </div>
</div>
